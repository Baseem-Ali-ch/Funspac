<%- include('../admin-layout/header.ejs') %>

<!-- ?PROD Only: Google Tag Manager (noscript) (Default ThemeSelection: GTM-5DDHKGP, PixInvent: GTM-5J3LMKC) -->
<noscript
  ><iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-5DDHKGP"
    height="0"
    width="0"
    style="display: none; visibility: hidden"
  ></iframe
></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
  <div class="layout-container">
    <!-- Menu -->

    <aside
      id="layout-menu"
      class="layout-menu menu-vertical menu bg-menu-theme"
    >
      <div class="app-brand demo">
        <a href="index.html" class="app-brand-link">
          <!-- <span class="app-brand-logo demo me-1">
            <span style="color: var(--bs-primary)">
              <svg
                width="30"
                height="24"
                viewBox="0 0 250 196"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.3002 1.25469L56.655 28.6432C59.0349 30.1128 60.4839 32.711 60.4839 35.5089V160.63C60.4839 163.468 58.9941 166.097 56.5603 167.553L12.2055 194.107C8.3836 196.395 3.43136 195.15 1.14435 191.327C0.395485 190.075 0 188.643 0 187.184V8.12039C0 3.66447 3.61061 0.0522461 8.06452 0.0522461C9.56056 0.0522461 11.0271 0.468577 12.3002 1.25469Z"
                  fill="currentColor"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M0 65.2656L60.4839 99.9629V133.979L0 65.2656Z"
                  fill="black"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M0 65.2656L60.4839 99.0795V119.859L0 65.2656Z"
                  fill="black"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.71 1.22393L193.355 28.5207C190.97 29.9889 189.516 32.5905 189.516 35.3927V160.631C189.516 163.469 191.006 166.098 193.44 167.555L237.794 194.108C241.616 196.396 246.569 195.151 248.856 191.328C249.605 190.076 250 188.644 250 187.185V8.09597C250 3.64006 246.389 0.027832 241.935 0.027832C240.444 0.027832 238.981 0.441882 237.71 1.22393Z"
                  fill="currentColor"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M250 65.2656L189.516 99.8897V135.006L250 65.2656Z"
                  fill="black"
                />
                <path
                  opacity="0.077704"
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M250 65.2656L189.516 99.0497V120.886L250 65.2656Z"
                  fill="black"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z"
                  fill="currentColor"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M12.2787 1.18923L125 70.3075V136.87L0 65.2465V8.06814C0 3.61223 3.61061 0 8.06452 0C9.552 0 11.0105 0.411583 12.2787 1.18923Z"
                  fill="white"
                  fill-opacity="0.15"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z"
                  fill="currentColor"
                />
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M237.721 1.18923L125 70.3075V136.87L250 65.2465V8.06814C250 3.61223 246.389 0 241.935 0C240.448 0 238.99 0.411583 237.721 1.18923Z"
                  fill="white"
                  fill-opacity="0.3"
                />
              </svg>
            </span>
          </span>
          <span class="app-brand-text demo menu-text fw-semibold ms-2"
            >Materio</span -->
          
            <img
              src="/assets/images/admin logo.png"
              alt="Furnspace Logo"
              width="105"
              height="50"
            />
        </a>

        <a
          href="javascript:void(0);"
          class="layout-menu-toggle menu-link text-large ms-auto"
        >
          <i class="menu-toggle-icon d-xl-block align-middle"></i>
        </a>
      </div>

      <div class="menu-inner-shadow"></div>

      <ul class="menu-inner py-1">
        <!-- Dashboards -->

        <!-- Layouts -->

        <!-- Front Pages -->

        <!-- Apps & Pages -->

        <!-- e-commerce-app menu start -->
        <li class="menu-item active open">
          <a href="javascript:void(0);" class="menu-link menu-toggle">
            <i class="menu-icon tf-icons ri-shopping-bag-3-line"></i>
            <div data-i18n="eCommerce">eCommerce</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="/admin/dashboard" class="menu-link">
                <div data-i18n="Dashboard">Dashboard</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Products">Products</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/product-list" class="menu-link">
                    <div data-i18n="Product List">Product List</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/admin/add-product" class="menu-link">
                    <div data-i18n="Add Product">Add Product</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/admin/category-list" class="menu-link">
                    <div data-i18n="Category List">Category List</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Order">Order</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="/admin/order-list" class="menu-link">
                    <div data-i18n="Order List">Order List</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="/admin/order-details" class="menu-link">
                    <div data-i18n="Order Details">Order Details</div>
                  </a>
                </li>
              </ul>
            </li>
            <li class="menu-item active open">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Customer">Customer</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item active">
                  <a href="/admin/allCustomer" class="menu-link">
                    <div data-i18n="All Customers">All Customers</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="javascript:void(0);" class="menu-link menu-toggle">
                    <div data-i18n="Customer Details">Customer Details</div>
                  </a>
                  <ul class="menu-sub">
                    <li class="menu-item">
                      <a
                        href="app-ecommerce-customer-details-overview.html"
                        class="menu-link"
                      >
                        <div data-i18n="Overview">Overview</div>
                      </a>
                    </li>
                    <li class="menu-item">
                      <a
                        href="app-ecommerce-customer-details-security.html"
                        class="menu-link"
                      >
                        <div data-i18n="Security">Security</div>
                      </a>
                    </li>
                    <li class="menu-item">
                      <a
                        href="app-ecommerce-customer-details-billing.html"
                        class="menu-link"
                      >
                        <div data-i18n="Address & Billing">
                          Address & Billing
                        </div>
                      </a>
                    </li>
                    <li class="menu-item">
                      <a
                        href="app-ecommerce-customer-details-notifications.html"
                        class="menu-link"
                      >
                        <div data-i18n="Notifications">Notifications</div>
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="menu-item">
              <a href="app-ecommerce-manage-reviews.html" class="menu-link">
                <div data-i18n="Manage Reviews">Manage Reviews</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="app-ecommerce-referral.html" class="menu-link">
                <div data-i18n="Referrals">Referrals</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="Settings">Settings</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-detail.html"
                    class="menu-link"
                  >
                    <div data-i18n="Store Details">Store Details</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-payments.html"
                    class="menu-link"
                  >
                    <div data-i18n="Payments">Payments</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-checkout.html"
                    class="menu-link"
                  >
                    <div data-i18n="Checkout">Checkout</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-shipping.html"
                    class="menu-link"
                  >
                    <div data-i18n="Shipping & Delivery">
                      Shipping & Delivery
                    </div>
                  </a>
                </li>
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-locations.html"
                    class="menu-link"
                  >
                    <div data-i18n="Locations">Locations</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a
                    href="app-ecommerce-settings-notifications.html"
                    class="menu-link"
                  >
                    <div data-i18n="Notifications">Notifications</div>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <!-- e-commerce-app menu end -->
        <!-- Academy menu start -->

        <!-- Academy menu end -->

        <li class="menu-item">
          <a href="javascript:void(0);" class="menu-link menu-toggle">
            <i class="menu-icon tf-icons ri-bill-line"></i>
            <div data-i18n="Invoice">Invoice</div>
            <div class="badge bg-danger rounded-pill ms-auto"></div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="app-invoice-list.html" class="menu-link">
                <div data-i18n="List">List</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="app-invoice-preview.html" class="menu-link">
                <div data-i18n="Preview">Preview</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="app-invoice-edit.html" class="menu-link">
                <div data-i18n="Edit">Edit</div>
              </a>
            </li>
            <li class="menu-item">
              <a href="app-invoice-add.html" class="menu-link">
                <div data-i18n="Add">Add</div>
              </a>
            </li>
          </ul>
        </li>
        <li class="menu-item">
          <a href="javascript:void(0);" class="menu-link menu-toggle">
            <i class="menu-icon tf-icons ri-user-line"></i>
            <div data-i18n="Users">Users</div>
          </a>
          <ul class="menu-sub">
            <li class="menu-item">
              <a href="app-user-list.html" class="menu-link">
                <div data-i18n="List">List</div>
              </a>
            </li>

            <li class="menu-item">
              <a href="javascript:void(0);" class="menu-link menu-toggle">
                <div data-i18n="View">View</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="app-user-view-account.html" class="menu-link">
                    <div data-i18n="Account">Account</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="app-user-view-security.html" class="menu-link">
                    <div data-i18n="Security">Security</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="app-user-view-billing.html" class="menu-link">
                    <div data-i18n="Billing & Plans">Billing & Plans</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="app-user-view-notifications.html" class="menu-link">
                    <div data-i18n="Notifications">Notifications</div>
                  </a>
                </li>
                <li class="menu-item">
                  <a href="app-user-view-connections.html" class="menu-link">
                    <div data-i18n="Connections">Connections</div>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </aside>
    <!-- / Menu -->

    <!-- Layout container -->
    <div class="layout-page">
      <!-- Navbar -->

      <nav
        class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
        id="layout-navbar"
      >
        <div
          class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none"
        >
          <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
            <i class="ri-menu-fill ri-24px"></i>
          </a>
        </div>

        <div
          class="navbar-nav-right d-flex align-items-center"
          id="navbar-collapse"
        >
        <!-- <nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
          <div class="container breadcrumbs">
            <ol class="breadcrumb">
              <% breadcrumbs.forEach(crumb => { %>
                <li class="breadcrumb-item">
                  <a href="<%= crumb.url %>"> <%= crumb.name %> </a>
                </li>
              <% }); %>
            </ol>
          </div>
        </nav> -->
          <!-- Search -->
          <!-- <div class="navbar-nav align-items-center">
            <div class="nav-item navbar-search-wrapper mb-0">
              <a
                class="nav-item nav-link search-toggler fw-normal px-0"
                href="javascript:void(0);"
              >
                <i class="ri-search-line ri-22px scaleX-n1-rtl me-1_5"></i>
                <span class="d-none d-md-inline-block text-muted ms-1_5"
                  >Search (Ctrl+/)</span
                >
              </a>
            </div>
          </div> -->
          <!-- /Search -->

          <ul class="navbar-nav flex-row align-items-center ms-auto">
           

            <!-- User -->
            <li class="nav-item navbar-dropdown dropdown-user dropdown">
              <a
                class="nav-link dropdown-toggle hide-arrow p-0"
                href="javascript:void(0);"
                data-bs-toggle="dropdown"
              >
                <div class="avatar avatar-online">
                  <img
                    src="/dashboard-assets/img/avatars/1.png"
                    alt
                    class="w-px-40 h-auto rounded-circle"
                  />
                </div>
              </a>
              <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                <li>
                  <a class="dropdown-item" href="pages-account-settings-account.html">
                    <div class="d-flex align-items-center">
                      <div class="flex-shrink-0 me-2">
                        <div class="avatar avatar-online">
                          <img src="/dashboard-assets/img/avatars/1.png" alt class="w-px-40 h-auto rounded-circle">
                        </div>
                      </div>
                      <div class="flex-grow-1">
                        <h6 class="mb-0 small"><%= isAdmin.name %></h6>
                        <small class="text-muted">Admin</small>
  
                      </div>
                    </div>
                  </a>
                </li>
                <li>
                  <div class="dropdown-divider"></div>
                </li>
                <li>
                  <a class="dropdown-item" href="/admin/admin-profile">
                    <i class="ri-user-3-line ri-22px me-2"></i>
                    <span class="align-middle">My Profile</span>
                  </a>
                </li>
                
                <li>
                  <div class="d-grid px-4 pt-2 pb-1">
                    <a class="btn btn-danger d-flex" href="/admin">
                      <small class="align-middle">Logout</small>
                      <i class="ri-logout-box-r-line ms-2 ri-16px"></i>
                    </a>
                  </div>
                </li>
              </ul>
        </div>

        <!-- Search Small Screens -->
        <div class="navbar-search-wrapper search-input-wrapper d-none">
          <input
            type="text"
            class="form-control search-input container-xxl border-0"
            placeholder="Search..."
            aria-label="Search..."
          />
          <i class="ri-close-fill search-toggler cursor-pointer"></i>
        </div>
      </nav>

      <!-- / Navbar -->

      <!-- Content wrapper -->
      <div class="content-wrapper">
        <!-- Content -->

        <div class="container-xxl flex-grow-1 container-p-y">
          <!-- customers List Table -->
          <div class="card">
            <div class="card-datatable table-responsive">
              <div
                id="DataTables_Table_0_wrapper"
                class="dataTables_wrapper dt-bootstrap5 no-footer"
              >
                <div
                  class="card-header d-flex rounded-0 flex-wrap pb-md-0 pt-0"
                >
                  <div class="me-5 pe-5">
                    <div
                      id="DataTables_Table_0_filter"
                      class="dataTables_filter"
                    >
                    <label>
                      <input
                        type="search"
                        class="form-control form-control-sm ms-0"
                        placeholder="Search Customer"
                        aria-controls="customer-table"
                        id="search-input"
                        onkeyup="searchTable()"
                      />
                    </label>
                    </div>
                  </div>
                  <div
                    class="d-flex justify-content-start justify-content-md-end align-items-baseline"
                  >
                    <div
                      class="dt-action-buttons d-flex align-items-start align-items-md-center justify-content-sm-center gap-4 pt-0"
                    >
                      <div
                        class="dataTables_length my-0"
                        id="DataTables_Table_0_length"
                      >
                        
                      </div>
                      <div class="dt-buttons btn-group flex-wrap d-flex">
                        <div class="btn-group">
                          <!-- <button
                            class="btn btn-secondary buttons-collection dropdown-toggle btn-outline-secondary me-4 waves-effect waves-light"
                            tabindex="0"
                            aria-controls="DataTables_Table_0"
                            type="button"
                            aria-haspopup="dialog"
                            aria-expanded="false"
                          >
                            <span
                              ><i class="ri-upload-2-line ri-16px me-1"></i>
                              <span class="d-none d-sm-inline-block"
                                >Export</span
                              ></span
                            >
                          </button> -->
                        </div>
                        <button
                          class="btn btn-secondary add-new btn-primary waves-effect waves-light"
                          tabindex="0"
                          aria-controls="DataTables_Table_0"
                          type="button"
                          data-bs-toggle="offcanvas"
                          data-bs-target="#offcanvasEcommerceCustomerAdd"
                        >
                          <span
                            ><i
                              class="ri-add-line ri-16px me-0 me-sm-1 align-baseline"
                            ></i
                            ><span class="d-none d-sm-inline-block"
                              >Add Customer</span
                            ></span
                          >
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <table
                  class="datatables-customers table dataTable no-footer dtr-column"
                  id="DataTables_Table_0"
                  aria-describedby="DataTables_Table_0_info"
                  style="width: 1043px"
                >
                  <thead>
                    <tr>
                      <th
                        class="control sorting_disabled dtr-hidden"
                        rowspan="1"
                        colspan="1"
                        style="width: 0px; display: none"
                        aria-label=""
                      ></th>
                      <th
                        class="sorting_disabled dt-checkboxes-cell dt-checkboxes-select-all"
                        rowspan="1"
                        colspan="1"
                        style="width: 18px"
                        data-col="1"
                        aria-label=""
                      >
                        <input type="checkbox" class="form-check-input" />
                      </th>
                      <th
                        class="sorting sorting_desc"
                        tabindex="0"
                        aria-controls="DataTables_Table_0"
                        rowspan="1"
                        colspan="1"
                        style="width: 266px"
                        aria-label="Customer: activate to sort column ascending"
                        aria-sort="descending"
                      >
                        Customer Id
                      </th>
                      <th
                        class="text-nowrap sorting"
                        tabindex="0"
                        aria-controls="DataTables_Table_0"
                        rowspan="1"
                        colspan="1"
                        style="width: 118px"
                        aria-label="Customer Id: activate to sort column ascending"
                      >
                        Customer Name
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="DataTables_Table_0"
                        rowspan="1"
                        colspan="1"
                        style="width: 205px"
                        aria-label="Country: activate to sort column ascending"
                      >
                        Email
                      </th>
                      <th
                        class="sorting"
                        tabindex="0"
                        aria-controls="DataTables_Table_0"
                        rowspan="1"
                        colspan="1"
                        style="width: 62px"
                        aria-label="Order: activate to sort column ascending"
                      >
                        Phone No
                      </th>
                      <th
                        class="text-nowrap sorting"
                        tabindex="0"
                        aria-controls="DataTables_Table_0"
                        rowspan="1"
                        colspan="1"
                        style="width: 114px"
                        aria-label="Total Spent: activate to sort column ascending"
                      >
                        Action
                      </th>
                    </tr>
                  </thead>

                  <tbody id="customer-table-body">
                    <% customers.forEach(function(customer, index) { %>
                      <tr id="row-<%= customer._id %>">
                        <td><%= index + 1 %></td>
                        <td><%= customer._id %></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <span class="text-heading fw-medium text-wrap static-text" id="name-text-<%= customer._id %>"><%= customer.name %></span>
                            <input type="text" class="form-control edit-input" id="edit-name-<%= customer._id %>" value="<%= customer.name %>" style="display: none;">
                          </div>
                        </td>
                        <td>
                          <div class="d-flex align-items-center">
                            <span class="text-heading fw-medium text-wrap static-text" id="email-text-<%= customer._id %>"><%= customer.email %></span>
                            <input type="email" class="form-control edit-input" id="edit-email-<%= customer._id %>" value="<%= customer.email %>" style="display: none;">
                          </div>
                        </td>
                        <td>
                          <div class="d-flex align-items-center">
                            <span class="text-heading fw-medium text-wrap static-text" id="phone-text-<%= customer._id %>"><%= customer.phone %></span>
                            <input type="text" class="form-control edit-input" id="edit-phone-<%= customer._id %>" value="<%= customer.phone %>" style="display: none;">
                          </div>
                        </td>
                        <td>
                          <div class="d-flex align-items-center justify-content-sm-center">
                            <button id="editBtn-<%= customer._id %>" class="btn btn-sm btn-icon btn-text-secondary waves-effect waves-light rounded-pill" onclick="toggleEdit('<%= customer._id %>')">
                              <i class="ri-edit-box-line ri-20px"></i> 
                            </button>
                            <button id="saveBtn-<%= customer._id %>" class="btn btn-sm btn-icon btn-text-secondary waves-effect waves-light rounded-pill" onclick="saveChanges('<%= customer._id %>')" style="display: none;">
                              <i class="ri-save-line ri-20px"></i> 
                            </button>
                            <select name="status" id="status-<%= customer._id %>" style="border: none; background-color: transparent; outline: none;" onchange="changeStatus('<%= customer._id %>', this.value)">
                              <option value="false" <%= customer.isListed ? '' : 'selected' %>>Blocked</option>
                              <option value="true" <%= customer.isListed ? 'selected' : '' %>>Unblocked</option>
                            </select>
                          </div>
                        </td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>

                <!-- Pagination controls -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
        <a class="page-link page-link-prev" href="?page=<%= currentPage - 1 %>" aria-label="Previous" tabindex="-1" aria-disabled="<%= currentPage === 1 %>">
          <span aria-hidden="true"><i class="icon-long-arrow-left"></i></span> Prev
        </a>
      </li>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <li class="page-item <%= currentPage === i ? 'active' : '' %>">
          <a class="page-link" href="?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>
      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
        <a class="page-link page-link-next" href="?page=<%= currentPage + 1 %>" aria-label="Next">
          Next <span aria-hidden="true"><i class="icon-long-arrow-right"></i></span>
        </a>
      </li>
    </ul>
  </nav>
                
                  <div class="col-sm-12 col-md-6">
                    
                  </div>
                </div>
                <div style="width: 1%"></div>
              </div>
            </div>
            <!-- Offcanvas to add new customer -->
            <div
              class="offcanvas offcanvas-end"
              tabindex="-1"
              id="offcanvasEcommerceCustomerAdd"
              aria-labelledby="offcanvasEcommerceCustomerAddLabel"
            >
              <div class="offcanvas-header border-bottom">
                <h5
                  id="offcanvasEcommerceCustomerAddLabel"
                  class="offcanvas-title"
                >
                  Add Customer
                </h5>
                <button
                  type="button"
                  class="btn-close text-reset"
                  data-bs-dismiss="offcanvas"
                  aria-label="Close"
                ></button>
              </div>
              <div class="offcanvas-body mx-0 flex-grow-0">
                <form
                  class="ecommerce-customer-add pt-0 fv-plugins-bootstrap5 fv-plugins-framework"
                  id="eCommerceCustomerAddForm"
                  onsubmit="return false"
                  novalidate="novalidate"
                >
                  <div class="ecommerce-customer-add-basic mb-5">
                    <h6 class="mb-5">Basic Information</h6>
                    <div
                      class="form-floating form-floating-outline mb-5 fv-plugins-icon-container"
                    >
                      <input
                        type="text"
                        class="form-control"
                        id="ecommerce-customer-add-name"
                        placeholder="John Doe"
                        name="customerName"
                        aria-label="John Doe"
                      />
                      <label for="ecommerce-customer-add-name">Name*</label>
                      <div
                        class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback"
                      ></div>
                    </div>
                    <div
                      class="form-floating form-floating-outline mb-5 fv-plugins-icon-container"
                    >
                      <input
                        type="text"
                        id="ecommerce-customer-add-email"
                        class="form-control"
                        placeholder="john.doe@example.com"
                        aria-label="john.doe@example.com"
                        name="customerEmail"
                      />
                      <label for="ecommerce-customer-add-email">Email*</label>
                      <div
                        class="fv-plugins-message-container fv-plugins-message-container--enabled invalid-feedback"
                      ></div>
                    </div>
                    <div class="form-floating form-floating-outline">
                      <input
                        type="text"
                        id="ecommerce-customer-add-contact"
                        class="form-control phone-mask"
                        placeholder="+(123) 456-7890"
                        aria-label="+(123) 456-7890"
                        name="customerContact"
                      />
                      <label for="ecommerce-customer-add-contact">Mobile</label>
                    </div>
                  </div>
                  <div class="ecommerce-customer-add-shiping mb-5">
                    <h6 class="mb-5">Shipping Information</h6>
                    <div class="form-floating form-floating-outline mb-5">
                      <input
                        type="text"
                        id="ecommerce-customer-add-address"
                        class="form-control"
                        placeholder="45 Roker Terrace"
                        aria-label="45 Roker Terrace"
                        name="customerAddress1"
                      />
                      <label for="ecommerce-customer-add-address"
                        >Address Line 1</label
                      >
                    </div>
                    <div class="form-floating form-floating-outline mb-5">
                      <input
                        type="text"
                        id="ecommerce-customer-add-address-2"
                        class="form-control"
                        placeholder="Address 2"
                        aria-label="address2"
                        name="customerAddress2"
                      />
                      <label for="ecommerce-customer-add-address-2"
                        >Address Line 2</label
                      >
                    </div>
                    <div class="form-floating form-floating-outline mb-5">
                      <input
                        type="text"
                        id="ecommerce-customer-add-town"
                        class="form-control"
                        placeholder="New York"
                        aria-label="New York"
                        name="customerTown"
                      />
                      <label for="ecommerce-customer-add-town">Town</label>
                    </div>
                    <div class="form-floating form-floating-outline mb-5">
                      <input
                        type="text"
                        id="ecommerce-customer-add-state"
                        class="form-control"
                        placeholder="Southern tip"
                        aria-label="Southern tip"
                        name="customerState"
                      />
                      <label for="ecommerce-customer-add-state"
                        >State / Province</label
                      >
                    </div>
                    <div class="form-floating form-floating-outline mb-5">
                      <input
                        type="text"
                        id="ecommerce-customer-add-post-code"
                        class="form-control"
                        placeholder="734990"
                        aria-label="734990"
                        name="pin"
                        pattern="[0-9]{8}"
                        maxlength="8"
                      />
                      <label for="ecommerce-customer-add-post-code"
                        >Post Code</label
                      >
                    </div>
                    <div
                      class="form-floating form-floating-outline form-floating-select2"
                    >
                      <div class="position-relative">
                        <select
                          id="ecommerce-customer-add-country"
                          class="select2 form-select select2-hidden-accessible"
                          data-select2-id="ecommerce-customer-add-country"
                          tabindex="-1"
                          aria-hidden="true"
                        >
                          <option value="" data-select2-id="2">Select</option>
                          <option value="Australia">Australia</option>
                          <option value="Bangladesh">Bangladesh</option>
                          <option value="Belarus">Belarus</option>
                          <option value="Brazil">Brazil</option>
                          <option value="Canada">Canada</option>
                          <option value="China">China</option>
                          <option value="France">France</option>
                          <option value="Germany">Germany</option>
                          <option value="India">India</option>
                          <option value="Indonesia">Indonesia</option>
                          <option value="Israel">Israel</option>
                          <option value="Italy">Italy</option>
                          <option value="Japan">Japan</option>
                          <option value="Korea">Korea, Republic of</option>
                          <option value="Mexico">Mexico</option>
                          <option value="Philippines">Philippines</option>
                          <option value="Russia">Russian Federation</option>
                          <option value="South Africa">South Africa</option>
                          <option value="Thailand">Thailand</option>
                          <option value="Turkey">Turkey</option>
                          <option value="Ukraine">Ukraine</option>
                          <option value="United Arab Emirates">
                            United Arab Emirates
                          </option>
                          <option value="United Kingdom">United Kingdom</option>
                          <option value="United States">
                            United States
                          </option></select
                        ><span
                          class="select2 select2-container select2-container--default"
                          dir="ltr"
                          data-select2-id="1"
                          style="width: 343px"
                          ><span class="selection"
                            ><span
                              class="select2-selection select2-selection--single"
                              role="combobox"
                              aria-haspopup="true"
                              aria-expanded="false"
                              tabindex="0"
                              aria-disabled="false"
                              aria-labelledby="select2-ecommerce-customer-add-country-container"
                              ><span
                                class="select2-selection__rendered"
                                id="select2-ecommerce-customer-add-country-container"
                                role="textbox"
                                aria-readonly="true"
                                ><span class="select2-selection__placeholder"
                                  >United States
                                </span></span
                              ><span
                                class="select2-selection__arrow"
                                role="presentation"
                                ><b role="presentation"></b></span></span></span
                          ><span
                            class="dropdown-wrapper"
                            aria-hidden="true"
                          ></span
                        ></span>
                      </div>
                      <label for="ecommerce-customer-add-country"
                        >Country</label
                      >
                    </div>
                  </div>

                  <div class="d-sm-flex mb-5">
                    <div class="me-auto mb-2 mb-md-0">
                      <h6 class="mb-1">Use as a billing address?</h6>
                      <small>If you need more info, please check budget.</small>
                    </div>
                    <div class="form-check form-switch my-auto me-n2">
                      <input type="checkbox" class="form-check-input" />
                    </div>
                  </div>
                  <div>
                    <button
                      type="submit"
                      class="btn btn-primary me-3 data-submit waves-effect waves-light"
                    >
                      Add
                    </button>
                    <button
                      type="reset"
                      class="btn btn-outline-danger waves-effect"
                      data-bs-dismiss="offcanvas"
                    >
                      Discard
                    </button>
                  </div>
                  <input type="hidden" />
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- / Content -->

        <!-- Footer -->
        <!-- <footer class="content-footer footer bg-footer-theme">
          <div class="container-xxl">
            <div
              class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column"
            >
              <div class="text-body mb-2 mb-md-0">
                ©
                <script>
                  document.write(new Date().getFullYear());
                </script>
                , made with
                <span class="text-danger"
                  ><i class="tf-icons ri-heart-fill"></i
                ></span>
                by
                <a
                  href="https://themeselection.com/"
                  target="_blank"
                  class="footer-link"
                  >ThemeSelection</a
                >
              </div>
              <div class="d-none d-lg-inline-block">
                <a
                  href="https://themeselection.com/license/"
                  class="footer-link me-4"
                  target="_blank"
                  >License</a
                >
                <a
                  href="https://themeselection.com/"
                  target="_blank"
                  class="footer-link me-4"
                  >More Themes</a
                >

                <a
                  href="https://demos.themeselection.com/materio-bootstrap-html-admin-template/documentation/"
                  target="_blank"
                  class="footer-link me-4"
                  >Documentation</a
                >

                <a
                  href="https://themeselection.com/support/"
                  target="_blank"
                  class="footer-link d-none d-sm-inline-block"
                  >Support</a
                >
              </div>
            </div>
          </div>
        </footer> -->
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
      </div>
      <!-- Content wrapper -->
    </div>
    <!-- / Layout page -->
  </div>

  <!-- Overlay -->
  <div class="layout-overlay layout-menu-toggle"></div>

  <!-- Drag Target Area To SlideIn Menu On Small Screens -->
  <div class="drag-target"></div>
</div>
<!-- / Layout wrapper -->



<!--Modal for editing user details-->
<!-- Edit Customer Modal -->
<div class="modal fade" id="editCustomerModal" tabindex="-1" role="dialog" aria-labelledby="editCustomerModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCustomerModalLabel">Edit Customer</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Form fields for editing customer -->
        <form id="editCustomerForm">
          <input type="hidden" id="edit-customer-id">
          <div class="form-group">
            <label for="edit-name">Name</label>
            <input type="text" class="form-control" id="edit-name" required>
          </div>
          <div class="form-group">
            <label for="edit-email">Email</label>
            <input type="email" class="form-control" id="edit-email" required>
          </div>
          <div class="form-group">
            <label for="edit-phone">Phone</label>
            <input type="text" class="form-control" id="edit-phone" required>
          </div>
          <!-- Additional fields as needed -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveCustomerChanges()">Save changes</button>
      </div>
    </div>
  </div>
</div>



<!--Bootstrap links-->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


<!-- Core JS -->
<!-- build:js assets/vendor/js/core.js -->
<script src="/dashboard-assets/vendor/libs/jquery/jquery.js"></script>
<script src="/dashboard-assets/vendor/libs/popper/popper.js"></script>
<script src="/dashboard-assets/vendor/js/bootstrap.js"></script>
<script src="/dashboard-assets/vendor/libs/node-waves/node-waves.js"></script>
<script src="/dashboard-assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
<script src="/dashboard-assets/vendor/libs/hammer/hammer.js"></script>
<script src="/dashboard-assets/vendor/libs/i18n/i18n.js"></script>
<script src="/dashboard-assets/vendor/libs/typeahead-js/typeahead.js"></script>
<script src="/dashboard-assets/vendor/js/menu.js"></script>

<!-- endbuild -->

<!-- Vendors JS -->
<script src="/dashboard-assets/vendor/libs/moment/moment.js"></script>
<script src="/dashboard-assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
<script src="/dashboard-assets/vendor/libs/select2/select2.js"></script>
<script src="/dashboard-assets/vendor/libs/%40form-validation/popular.js"></script>
<script src="/dashboard-assets/vendor/libs/%40form-validation/bootstrap5.js"></script>
<script src="/dashboard-assets/vendor/libs/%40form-validation/auto-focus.js"></script>
<script src="/dashboard-assets/vendor/libs/cleavejs/cleave.js"></script>
<script src="/dashboard-assets/vendor/libs/cleavejs/cleave-phone.js"></script>

<!-- Main JS -->
<script src="/dashboard-assets/js/main.js"></script>

<!-- Page JS -->
<!-- <script src="/dashboard-assets/js/app-ecommerce-customer-all.js"></script> -->



<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
<script>




function showDangerAlert(title, message) {
  Swal.fire({
    icon: 'error',
    title: title,
    text: message,
    confirmButtonColor: '#d33',
    confirmButtonText: 'OK',
    width: '20rem',
    
    customClass: {
      title: 'text-danger fs-6 fw-bold',
      content: 'text-danger fs-7'
    }
  });
}




function toggleEdit(customerId) {
  const editInputs = document.querySelectorAll(`#row-${customerId} .edit-input`);
  const staticTexts = document.querySelectorAll(`#row-${customerId} .static-text`);
  const editBtn = document.getElementById(`editBtn-${customerId}`);
  const saveBtn = document.getElementById(`saveBtn-${customerId}`);

  const isInEditMode = editInputs[0].style.display === 'inline-block';

  if (isInEditMode) {
    editInputs.forEach(input => input.style.display = 'none');
    staticTexts.forEach(text => text.style.display = 'inline-block');
    editBtn.style.display = 'inline-block';
    saveBtn.style.display = 'none';
  } else {
    editInputs.forEach(input => input.style.display = 'inline-block');
    staticTexts.forEach(text => text.style.display = 'none');
    editBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
  }
}



async function saveChanges(customerId) {
  try {
    const editNameElem = document.getElementById(`edit-name-${customerId}`);
    const editEmailElem = document.getElementById(`edit-email-${customerId}`);
    const editPhoneElem = document.getElementById(`edit-phone-${customerId}`);

    const editName = editNameElem.value.trim();
    const editEmail = editEmailElem.value.trim();
    const editPhone = editPhoneElem.value.trim();

    if (!isValidName(editName)) {
      showDangerAlert('Invalid name format. Only alphabets and spaces are allowed.');
      return;
    }

    if (!isValidEmail(editEmail)) {
      showDangerAlert('Invalid email format.');
      return;
    }

    if (!isValidPhone(editPhone)) {
      showDangerAlert('Invalid phone number format. Must be 10 digits.');
      return;
    }

    const response = await fetch(`/admin/update-customer/${customerId}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: editName, email: editEmail, phone: editPhone })
    });

    if (!response.ok) throw new Error('Network response was not ok');

    const updatedCustomer = await response.json();

    document.getElementById(`name-text-${customerId}`).textContent = updatedCustomer.name;
    document.getElementById(`email-text-${customerId}`).textContent = updatedCustomer.email;
    document.getElementById(`phone-text-${customerId}`).textContent = updatedCustomer.phone;

    toggleEdit(customerId);

    Swal.fire({
      icon: 'success',
      title: 'Success',
      text: 'Customer updated successfully!'
    });
  } catch (error) {
    console.error('Error updating customer:', error);
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Failed to update customer. Please try again.'
    });
  }
}

function isValidName(name) {
  return /^[a-zA-Z][a-zA-Z\s]*$/.test(name);
}

function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

function isValidPhone(phone) {
  return /^[1-9]\d{9}$/.test(phone);
}






async function changeStatus(customerId, status) {
  try {
    const response = await fetch(`/admin/change-status/${customerId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ isListed: status === 'true' })
    });

    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const result = await response.json();
    console.log(result);

    // Update the status text in the table
    const statusElem = document.querySelector(`#row-${customerId} .status`);
    if (statusElem) {
      statusElem.textContent = result.customer.isListed ? 'Listed' : 'Unlisted';
    }

    Swal.fire({
      icon: 'success',
      title: 'Success',
      text: 'Status updated successfully!'
    });
  } catch (error) {
    console.error('Error updating status:', error);
    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'Failed to update status. Please try again.'
    });
  }
}

const changeCustomer = async (req, res) => {
  const customerId = req.params.id;
  const { isListed } = req.body;

  try {
    const updatedCustomer = await userModel.findByIdAndUpdate(
      customerId,
      { isListed },
      { new: true }
    );

    if (!updatedCustomer) {
      return res.status(404).json({ error: "Customer not found" });
    }

    res.json({
      message: "Listing status updated successfully",
      customer: updatedCustomer,
    });
  } catch (error) {
    console.error("Error updating listing status:", error);
    return res.status(500).json({ error: "Server Error" });
  }
};








  function searchTable() {
  const input = document.getElementById('search-input');
  const filter = input.value.toLowerCase();
  const tableBody = document.getElementById('customer-table-body');
  const rows = tableBody.getElementsByTagName('tr');

  for (let i = 0; i < rows.length; i++) {
    const name = rows[i].querySelector('.static-text[id^="name-text"]').textContent.toLowerCase();
    const email = rows[i].querySelector('.static-text[id^="email-text"]').textContent.toLowerCase();
    const phone = rows[i].querySelector('.static-text[id^="phone-text"]').textContent.toLowerCase();
    
    if (name.indexOf(filter) > -1 || email.indexOf(filter) > -1 || phone.indexOf(filter) > -1) {
      rows[i].style.display = '';
    } else {
      rows[i].style.display = 'none';
    }
  }
}





</script>








<%- include('../admin-layout/footer.ejs') %>

<!-- Mirrored from demos.themeselection.com/materio-bootstrap-html-admin-template/html/vertical-menu-template/app-ecommerce-customer-all.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 25 Jun 2024 05:50:34 GMT -->

<!-- beautify ignore:end -->
